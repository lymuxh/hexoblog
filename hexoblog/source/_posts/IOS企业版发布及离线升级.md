---
title: IOS企业版发布及离线升级
date: 2016-10-27 17:08:41
tags: [IOS企业版,APP离线升级]
---

### IOS开发证书分类

苹果对开发者主要分为3类：个人、组织（公司、企业）、教育机构。即：

* 个人（Individual）

* 组织（Organizations）
   组织类又分为2个小类：

  （1）公司（Company）

  （2）企业（Enterprise）

* 教育机构（Educational Institutions）

我们经常最关注的是个人、公司、企业这3类，公司和企业都属于“组织”大类，下面对这3个做下简单对比：

<!-- more -->

 * 个人（Individual）：

 （1）费用：99美元一年

 （2）App Store上架：是

 （3）最大uuid支持数：100

 （4）协作人数：1人（开发者自己）

  说明：“个人”开发者可以申请升级“公司”，可以通过拨打苹果公司客服电话（400 6701 855）来咨询和办理。

 * 公司（Company）：

 （1）费用：99美元一年

 （2）App Store上架：是

 （3）最大uuid支持数：100

 （4）协作人数：多人

 允许多个开发者进行协作开发，比个人多一些帐号管理的设置，可设置多个Apple ID，分4种管理级别的权限。
说明：申请时需要填写公司的邓白氏编码（DUNS Number）。

 * 企业 （Enterprise）

 （1）费用：299美元一年

 （2）App Store上架：否

  即该账号开发应用不能发布到App Store，只能企业内部应用。

 （3）最大uuid支持数：不限制

 （4）协作人数：多人

  费用：299美元一年

 说明：需要注意的是，企业账号开发的应用不能上线App Store，适合那些不希望公开发布应用的企业。同样，申请时也需要公司的邓白氏编码（DUNS Number）。

 ### 问题：国内的公司为什么不大范围使用企业开发证书

  对于发布来说，Android可以发布到任意的平台，也可以挂到自己的官网上，如果使用了企业开发者证书也可以任意发布，为什么国内的公司不经常这么做呢？总结各方面的答案：
 * 冲榜.AppStore是苹果官方唯一指定的应用发布平台，如果想获得更多的用户，AppStore是一个很好的渠道，而上AppStore不能使用企业开发用户的。如果是收费的应用，是必须上AppStore的。如果想内嵌广告，也是要上AppStore 的。
 * 企业开发者账户的限制：iphone5 ios7.1会有不做假bundleID无法安装的问题；ios 8.3有无法更新app的问题；ios9有企业证书信任问题，需要用户授权，用户自己授权的app使用过程中一切问题自己承担。

### 企业版发布怎么办呢

1. 首先要企业版的开发者帐号

2. 证书配置参考 IOS开发--企业版IDP的申请及“In House”发布

3. 打ipa包

### 以无线方式安装应用程序

iOS 支持以无线方式安装企业级应用程序，这可让您在不使用 iTunes 的情况下将内部软件分发给用户。要求如下：

 * 已鉴定的用户可访问的安全 Web 服务器

 * .ipa 格式的 iOS 应用程序，经构建用于发布/生产（使用了企业级预置描述文件）

 * 本文稿中稍后描述的 XML 清单文件

 * 可让设备访问 Apple iTunes 服务器的网络配置

安装应用程序很简单。用户可以将清单文件从您的网站上下载到他们的 iOS 设备上。该清单文件会指示设备下载和安装该清单文件中所引用的应用程序。

您可以分发 URL 以便通过短信或电子邮件来下载清单文件，也可以将它嵌入您所创建的其他企业级应用程序中。

由您设计和主管用于分发应用程序的网站。确定用户已被鉴定（可能是使用基本鉴定或基于目录的鉴定），并确定网站可通过内联网或互联网进行访问。您可以将应用程序和清单文件放入隐藏的目录中，或任何可使用 HTTP 或 HTTPS 来读取的其他位置中。

### 准备企业级应用程序进行无线分发

若要准备企业级应用程序进行无线分发，您应该构建归档的版本（.ipa 文件），以及构建清单文件以启用应用程序的无线分发和安装。

#### 使用 Xcode 来创建应用程序归档。

使用您的分发证书给应用程序签名并在归档中包括您的企业级开发预置描述文件。有关清单文件的信息，请参阅以下内容。有关构建和归档应用程序的更多信息，请访问 iOS Dev Center（iOS 开发中心）或参阅《Xcode User Guide》（Xcode 使用手册），可通过 Xcode 中的“Help”（帮助）菜单来访问该使用手册。

#### 关于无线清单文件

清单文件是 XML plist 格式的。iOS 设备使用它在 Web 服务器上查找应用程序，以及从 Web 服务器上下载和安装应用程序。清单文件是由 Xcode 创建的，使用您在共享归档的应用程序以进行企业级分发时所提供的信息。

以下是必填的：

| 项目           | 描述           |
| ------------- |---------------|
| URL           | 应用程序 (.ipa) 文件的完整合格的 HTTP 或 HTTPS URL。 |
| display-image  | 下载和安装过程中显示的 57 x 57 像素 PNG 图像。指定图像的完整合格的 URL。      |
| full-size-image | 用来在 iTunes 中表示应用程序的 512 x 512 像素 PNG 图像      |
| bundle-identifier | 您应用程序的包标识符，与 Xcode 项目中指定的完全一样。            |
| bundle-version | 您应用程序的包版本，在 Xcode 项目中指定。            |
| title        | 下载和安装过程中显示的应用程序的名称。            |

仅对于“报刊杂志”应用程序，需要填写以下栏位：

| 项目           | 描述           |
| ------------- |---------------|
| newsstand-image| 完整大小的 PNG 图像，用于显示在“报刊杂志”书架上。 |
| UINewsstandBindingEdge UINewsstandBindingType   | 这些键必须与“报刊杂志”应用程序中的 info.plist 中的键相符。      |
| UINewsstandApp | 指示该应用程序是“报刊杂志”应用程序。      |


您可以使用的一些可选键如示例清单文件所述。例如，如果应用程序文件太大并且您想要在执行错误检验（TCP 通信通常会执行该操作）的基础上确保下载的完整性，则可以使用 MD5 键。

您可以使用单个清单文件安装多个应用程序，方法是指定 items 数组的附加成员。


#### 构建网站

将这些项目上传到您网站上已鉴定的用户可以访问的区域：

应用程序 (.ipa) 文件

清单 (.plist) 文件

您的网站设计可以像用来链接到清单文件的单个页面那么简单。当用户轻按 Web 链接时，清单文件会被下载，并触发它所描述的应用程序的下载和安装。

以下是一个示例链接：

![img](/images/itms-services.png)

注意：
1. 请勿添加归档的应用程序 (.ipa) 的 Web 链接。载入清单文件时，设备会下载该 .ipa。虽然 URL 的协议部分是 itms-services，但 iTunes Store 并不参与此过程。
2. 设定服务器 MIME 类型
您可能需要配置您的 Web 服务器以便正确地传输清单文件和应用程序文件。
3. 对于 OS X Server，将以下 MIME 类型添加到 Web 服务的“MIME Types”（MIME 类型）设置中： application/octet-stream ipa text/xml plist
对于 IIS，使用 IIS Manager 在服务器的“属性”页面中添加 MIME 类型：.ipa application/octet-stream
.plist text/xml 。

### 个人开发者帐号＋wireless install 实现非app store程序的在线更新功能

在app中添加检测版本号的代码：

调用查询最新版本号的web 服务， 拿到后与本地的版本号进行对比，如不一致则提示用户进行更新，用户确定更新后，运行类似以下的代码：

```objective-c
NSString *urlString = @"itms-services://?action=download-manifest&url=http://xxx.com/apps/WirelessApp.plist";

```
```
 NSURL *url  = [NSURL URLWithString:urlString];
 [[UIApplication
 sharedApplication] openURL:url];
 ```
